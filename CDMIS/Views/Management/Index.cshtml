@model CDMIS.ViewModels.UserViewModel
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewBag.Title = "用户维护";
}
<link href="../../Content/jquery.dataTables.css" rel="stylesheet" type="text/css" />
<link href="../../Content/simpleModal.css" rel="stylesheet" type="text/css" />
<link rel="Stylesheet" href="../../Content/chosen.css" />
<script type="text/javascript" src="../../Scripts/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="../../Scripts/MicrosoftAjax.js"></script>
<script type="text/javascript" src="../../Scripts/MicrosoftMvcAjax.js"></script>
<script type="text/javascript" src="../../Scripts/jquery.unobtrusive-ajax.min.js"></script>
<script type="text/javascript" src="../../Scripts/jquery.dataTables.js"></script>
<script type="text/javascript" src="../../Scripts/chosen.jquery.min.js"></script>
<script type="text/javascript" src="../../Scripts/jquery.simplemodal.1.4.4.min.js"></script>
<script type="text/javascript" src="../../Scripts/My97DatePicker/WdatePicker.js"></script>
<style type="text/css">
    #alert-container
    {
        height: 150px;
        width: 400px;
    }
     #simplemodal-container 
     {
         height:500px; 
         width:400px;
     }
     #reminder-container
     {
         height:800px; 
         width:550px;
     }
</style>
<div  style="width:100%;border: 0;">
    @using (Ajax.BeginForm("UserPartialView", "Management", null,
                            new AjaxOptions
                            {
                                UpdateTargetId = "UserSearchContainer",
                                HttpMethod = "Post",
                                OnSuccess = " ",
                            }))
    { 
                            
                            
@*<div style="height:50px; visibility: hidden"></div>*@
        <div class="form-horizontal" role="form">
            <div class="form-group">
                <div class="col-sm-offset-10 col-sm-2">
                    <input type="button" class="btn btn-primary" id="NewRole" value="新建用户／角色" style="font-size: 16px;float:right;" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">
                    用户类别</label>
                <div class="col-sm-2"> 
                    @Html.DropDownListFor(m => m.Patient.Class, Model.UserClassList(), new { id = "SearchRole", @onchange = "onSearch()", style = "font-size:18px", @class = "form-control" })
                </div>
                <label class="col-sm-1 control-label">
                    手机号</label>
                <div class="col-sm-2">
                    @Html.TextBoxFor(model => model.SearchPhoneNo, new { id = "SearchPhoneNo", @onkeydown = "onSearch()", @class = "form-control" })
                </div>
                <label class="col-sm-1 control-label">
                    姓名</label>
                <div class="col-sm-2">
                    @Html.TextBoxFor(model => model.SearchUserName, new { id = "SearchUserName", @onkeydown = "onSearch()", @class = "form-control" })
                </div>
            </div>
        </div>
                            

                               
                            
    }

    <fieldset style="width: 100%; height: 700px">
        <legend>用户信息列表</legend>
        <div id="UserSearchContainer">
            <table  id="UserListDT" class="display">
                <thead class="fixedHeader">
                    <tr>
                        <th >
                            用户ID
                        </th>
                        <th >
                            姓名
                        </th>
                        <th >
                            密码
                        </th>
                        <th  style="display: none;">
                            用户类别编码
                        </th>
                        <th >
                            用户类别
                        </th>
                        <th >
                            密码有效期
                        </th>
                        <th >
                            手机号
                        </th>
                        <th >
                            操作
                        </th>
                    </tr>
                </thead>
                <tbody id="TableBody" class="scrollContent">
                    @if (Model.RowCount > 0)
                    {
                        foreach (var item in Model.UserList)
                        {
                        <tr class="normalRow">
                            <td >@item.UserId
                            </td>
                            <td >@item.UserName
                            </td>
                            <td >@item.Password
                            </td>
                            <td  style="display: none;">@item.Class
                            </td>
                            <td >@item.ClassName
                            </td>
                            <td >@item.EndDate
                            </td>
                            <td >@item.PhoneNo
                            </td>
                            <td >
                                @if(item.Class == "Patient")
                                {
                                    <input type="button" value="分配医生" class="btn btn-primary setDocBtn"/>
                                }
                                |
                                @*@if (item.Class == "Administrator")
                                {
                                    <input type="button" value="新建角色" class="btn btn-primary newroleBtn" disabled="disabled"/>
                                }
                                else
                                {
                                    <input type="button" value="新建角色" class="btn btn-primary newroleBtn" />
                                
                                }
                                |*@
                                <input type="button" value="编辑" class="btn btn-primary editBtn" />
                                |
                                <input type="button" value="删除" class="btn btn-primary deleteBtn" />
                            </td>
                        </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </fieldset>
@*    <div style="width: 100%; height: 500px;">
        @Html.ValidationSummary(true, "User Information update was unsuccessful. Please correct the errors and try again.")
    </div>*@
</div>
<div id="setUserInfo" >
    <div class="modalHeader">
        <span>用户信息设定</span></div>
    <div class="modalContent">
        <fieldset> 
            <legend>用户信息设定</legend>
            <div class="form-horizontal" role="form">
                <div class="form-group" id="PhoneNo1Div">
                    <label class="col-sm-4 control-label">
                        *手机号</label>
                    <div class="col-sm-8">
                        <input  id = "PhoneNo1"  name = "PhoneNo1"  class = "form-control"  style="width:65%;float:left;" value=""/>
                        <button id="checkPhoneNo1"  class="btn btn-primary" style="width:33%;float:right;" >验证手机号</button>
                        <p id="phoneWrn1" style="font-size: 16px; color: #FF0000; font-weight: bold;display: none"></p>
                        <div id="phoneWrn2Div">
                            <p id="phoneWrn2" style="font-size: 16px; color: #FF0000; font-weight: bold;float:left;">是否新建管理员？</p>
                            <button id="checkPhoneNo2"  class="btn btn-primary" style="width:33%;float:right" >确认</button>
                        </div>
                    </div>
                
                </div>

                <div class="form-group" id="New" style="display: none">
                    <label class="col-sm-4 control-label">
                        用户类别</label>
                    <div class="col-sm-8">
                        @Html.DropDownListFor(m => m.Patient.Class, Model.RoleClassList(), new { id = "newUserClass", style = "width:65%;float:left;font-size:18px", @onchange = "UserClassChanged()", @class = "form-control" })
                        <button id="checknewUserClass"  class="btn btn-primary" style="width:33%;float:right" >确认</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-4 control-label">
                        *用户ID</label>
                    <div class="col-sm-8">
                        @Html.TextBoxFor(m => m.Patient.UserId, new { @readonly = "true", id = "txtUserId", @class = "form-control" })
                        <p id="UIdWrn" style="font-size: 16px; color: #FF0000; font-weight: bold;display: none"></p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">
                        用户名</label>
                    <div class="col-sm-8">
                        @Html.TextBoxFor(m => m.Patient.UserName, new { id = "txtUserName", @class = "form-control" })
                    </div>
                </div>
                <div class="form-group" id="userClassListDiv">
                    <label class="col-sm-4 control-label">
                        用户类别</label>
                    <div class="col-sm-8">
                        @Html.TextBoxFor(m => m.Patient.ClassName, new { @readonly = "true", id = "userClassList", @class = "form-control" })
                    </div>
                </div>
                <div class="form-group" style="display: none">
                    <label class="col-sm-4 control-label">
                        用户类别代码</label>
                    <div class="col-sm-8">
                        @Html.TextBoxFor(m => m.Patient.Class, new { @readonly = "true", id = "userClassCode", @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">
                        密码</label>
                    <div class="col-sm-8">
                        @Html.TextBoxFor(m => m.Patient.Password, new { id = "txtPassword", @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">
                        密码有效期</label>
                    <div class="col-sm-8">
                        @Html.TextBoxFor(model => model.Patient.EndDate, new { id = "EndDate", @class = "form-control", @onclick = "WdatePicker({startDate:'1991-02-14',dateFmt:'yyyy-MM-dd'})" })
                    </div>
                </div>
                <div class="form-group" id="PhoneNoDiv">
                    <label class="col-sm-4 control-label">
                        *手机号</label>
                    <div class="col-sm-8">
                        @*@Html.TextBoxFor(model => model.Patient.PhoneNo, new { id = "PhoneNo", name="PhoneNo", @class = "form-control" })*@
                        <input  id = "PhoneNo", name = "PhoneNo", class = "form-control", value=""/> 
                        <p id="phoneWrn" style="font-size: 16px; color: #FF0000; font-weight: bold;display: none"></p>
                    </div>
                </div>
            
                <div id="CoachAndDoc" style="display: none">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            工作单位</label>
                        <div class="col-sm-8">
                            @Html.DropDownListFor(m => m.UnitName, Model.GetHospitalList(), new { id = "UnitName", @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            科室</label>
                        <div class="col-sm-8">
                            @Html.DropDownListFor(m => m.Dept, Model.GetDeptList(), new { id = "Dept", @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            职务</label>
                        <div class="col-sm-8">
                            @Html.DropDownListFor(m => m.JobTitle, Model.JobTitleList(), new { id = "JobTitle", @class = "form-control" })
                        </div>
                    </div>
                </div>
                <div id="DocMod" class="form-group">
                    <label class="col-sm-4 control-label">
                        模块</label>
                    <div class="col-sm-8">
                        @Html.ListBoxFor(m => m.models, Model.ModelsTypeList, new { id = "Modules", @class = "form-control chzn-select", multiple = "multiple", style = "font-size:34px;width:100%;height:34px;" })
                    </div>
                </div>
                <div class="form-group">
                     <div class="col-sm-offset-3 col-sm-3">
                        <input type="button" class="btn btn-primary" id="Save" value="保存" style="font-size: 16px;
                            margin-top: 30px" />
                    </div>
                    <div class="col-sm-3">
                        <input type="button" class="btn btn-primary" id="Cancel" value="取消" style="font-size: 16px;
                            margin-top: 30px" />
                    </div>
                    <div class="col-sm-3">
                    </div>
                </div>
        </div>
        </fieldset>
    </div>
</div>
<div id="addDataDiv" style="display: none;">
    <div class="modalHeader">
        <span>信息错误！</span></div>
    <div class="modalContent">
        <center>
            <p id="addDataP">
            </p>
            <input type="button" class="btn btn-default simplemodal-close" value="确定" />
        </center>
    </div>
</div>

<div id="DeleteRoleDataDiv" style="display: none;">
    <div class="modalHeader">
        <span>删除角色</span></div>
    <div class="modalContent">
        <center>
            <p id="DeleteRoleDataP" style="font-size: 16px; color: #FF0000; font-weight: bold;">
            </p>
            <input type="button" class="btn btn-primary" value="确定" id="DeleteRoleDataSure" />
            <input type="button" class="btn btn-default simplemodal-close" id="CancelDeleteRoleDataSure" value="取消" />
        </center>
    </div>
</div>

<div id="DeleteRoleStatusDiv" style="display: none;">
    <div class="modalHeader">
        <span>删除角色</span></div>
    <div class="modalContent">
        <center>
            <p id="DeleteRoleStatusP" style="font-size: 16px; color: #FF0000; font-weight: bold;">
            </p>
            <input type="button" class="btn btn-primary" value="确定" id="DeleteRoleStatusSure" />
        </center>
    </div>
</div>

<div id="success" style="display: none;">
    <div class="modalHeader">
        <span></span>
    </div>
    <div class="modalContent">
        <center>
            <p id="successD">
            </p>
            <input type="button" class="btn btn-default simplemodal-close" value="确定" />
        </center>
    </div>
</div>
<script type="text/javascript">
    var newflag = 0;
    var OriPhoneNo = "";
    var UId = "";
    var deleteUid = "";
    var deleteClassCode = "";
    var deleteClass = "";
    var deleteName = "";

    function hide() {
        var target = document.getElementById("UserListDT");
        target.style.display = "none";
    }
    function success() {
        var target = document.getElementById("UserListDT");
        target.style.display = "block";
    }

    $(document).ready(function () {
        $("#menu a").attr("id", ""); //Reset id's 
        $("#menu li:eq(0) a").attr("id", "current");

        var table = $('#UserListDT').DataTable({
            "oLanguage": {//语言国际化
                "sUrl": "/Content/jquery.dataTable.cn.txt"
            },
            "bAutoWidth": true,
            "bPaginate": false,  //是否分页。
            "sScrollX": "100%",
            "sScrollY": "500px",
            "order": [3, 'desc'],   //排序
            "bFilter": false,
            "columnDefs": [{ "bSortable": false, "aTargets": [7]}] //禁止某些列的排序功能

        });

        $("#UserListDT").attr("width", "auto");

        //$(".chosen").trigger('liszt:updated');
//        $('.chzn-select').chosen({
//            placeholder_text_multiple: " "
//        });

        //$(".chosen").chosen().change();
        //        $(".chosen").trigger('chosen:updated');

        //   $('#DocMod').attr('style', "display:none");
        $('#DocMod').css("display", "none");
        $('#setUserInfo').css("display", "none");

        $.ajax({                                                //初始化日期控件为系统当前时间+1年（默认密码有效期为一年）
            url: "/Management/GetDefaultEndTime",
            type: "GET",
            dataType: "json",
            async: false,
            data: {},
            success: function (res) {
                document.getElementById("EndDate").value = res.toString();
            }
        });

    });

    //编辑按钮触发
    $(".editBtn").click(function () {
        newflag = 0;
        $('#PhoneNoDiv').css("display", "block");
        $('#PhoneNo1Div').css("display", "none");
        $('#userClassListDiv').css("display", "block");
        
        $('#New').css("display", "none");
        $('#phoneWrn').css("display", "none");
        $('#UIdWrn').css("display", "none");

        trSeq = $(this).parent().parent().parent().find("tr").index($(this).parent().parent());
        var txtUserId = $("#TableBody tr:eq(" + trSeq + ") td:eq(0)").text().trim();

        document.getElementById("txtUserId").value = txtUserId;
        var userId = txtUserId;
        var txtUserName = $("#TableBody tr:eq(" + trSeq + ") td:eq(1)").text().trim();
        document.getElementById("txtUserName").value = txtUserName;
        var txtPassword = $("#TableBody tr:eq(" + trSeq + ") td:eq(2)").text().trim();
        document.getElementById("txtPassword").value = txtPassword;
        var userClassCode = $("#TableBody tr:eq(" + trSeq + ") td:eq(3)").text().trim();

        var userClass = $("#TableBody tr:eq(" + trSeq + ") td:eq(4)").text().trim();
        document.getElementById("userClassList").value = userClass;
        document.getElementById("userClassCode").value = userClassCode;
        var EndDate = $("#TableBody tr:eq(" + trSeq + ") td:eq(5)").text().trim();

        document.getElementById("EndDate").value = EndDate;
        $("#PhoneNo").val(GetPhoneNo(userId));
        OriPhoneNo = document.getElementById("PhoneNo").value;
        if (userClassCode == 'HealthCoach') {
            $('#CoachAndDoc').css("display", "block");
            $('#DocMod').css("display", "none");
            GetDoctorDetailInfo(userId, userClassCode);

            $('#setUserInfo').modal({
                closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
                containerId: 'reminder-container',
                overlayClose: true     //点击蒙层关闭窗口
            });

        }
        else if (userClassCode == 'Doctor') {
            $('#CoachAndDoc').css("display", "block");
            $('#DocMod').css("display", "block");
            //$("#Modules").removeClass("chosen");
            //          $("#Modules").trigger("liszt:updated");
            //          $("#Modules").chosen();


            $('#setUserInfo').modal({
                closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
                containerId: 'reminder-container',
                overlayClose: true     //点击蒙层关闭窗口
            });

            //            $("#Modules").trigger("liszt:updated");
            //            $("#Modules").chosen();
            GetDoctorDetailInfo(userId, userClassCode);
        }
        else {

            $('#CoachAndDoc').css("display", "none");
            $('#DocMod').css("display", "none");
            $('#setUserInfo').modal({
                closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
                containerId: 'simplemodal-container',
                overlayClose: true     //点击蒙层关闭窗口
            });
        }
        $("#Dept").chosen({
            no_results_text: "没有找到相应的选项",
            placeholder_text: "请选择",
        });
    });



    //删除按钮触发
    $(".deleteBtn").click(function () {

        trSeq = $(this).parent().parent().parent().find("tr").index($(this).parent().parent());
        var txtUserId = $("#TableBody tr:eq(" + trSeq + ") td:eq(0)").text().trim();
        var userClassCode = $("#TableBody tr:eq(" + trSeq + ") td:eq(3)").text().trim();
        var userClass = $("#TableBody tr:eq(" + trSeq + ") td:eq(4)").text().trim();
        var txtUserName = $("#TableBody tr:eq(" + trSeq + ") td:eq(1)").text().trim();

        deleteUid = txtUserId;
        deleteName = txtUserName;
        deleteClassCode = userClassCode;
        deleteClass = userClass;
        document.getElementById("DeleteRoleDataP").innerHTML = "确定删除" + txtUserName + "(" + txtUserId + ")" + "的" + userClass + "角色吗？";
        $('#DeleteRoleDataDiv').modal({
            closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
            containerId: 'alert-container',
            overlayClose: true     //点击蒙层关闭窗口
        });

    });
    $("#DeleteRoleDataSure").click(function () {
        var ret = 2;
        var txtUserId = deleteUid;
        var userClassCode = deleteClassCode;
        var userClass = deleteClass;
        var userName = deleteName;
        deleteName = ""
        deleteUid = "";
        deleteClassCode = "";
        deleteClass = "";
        $.ajax({                                                //初始化日期控件为系统当前时间+1年（默认密码有效期为一年）
            url: "/Management/DeleteRoleData",
            type: "GET",
            dataType: "json",
            async: false,
            data: { UId: txtUserId, userClassCode: userClassCode },
            success: function (res) {
                ret = res;
            }
        });
        if (ret == 1) {
            $("#CancelDeleteRoleDataSure").click();
            document.getElementById("DeleteRoleStatusP").innerHTML = "删除" + userName + "（" + txtUserId + "）" + "的" + userClass + "角色成功！";
            $('#DeleteRoleStatusDiv').modal({
                closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
                containerId: 'alert-container',
                overlayClose: true     //点击蒙层关闭窗口
            });

        }
        else {
            $("#CancelDeleteRoleDataSure").click();
            document.getElementById("DeleteRoleStatusP").innerHTML = "删除" + userName + "（" + txtUserId + "）" + "的" + userClass + "角色失败！";
            $('#DeleteRoleStatusDiv').modal({
                closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
                containerId: 'alert-container',
                overlayClose: true     //点击蒙层关闭窗口
            });
        }
    });
    $("#DeleteRoleStatusSure").click(function () {
        window.location.href = window.location.href;
    });
    
    //删除按钮触发
    $(".newroleBtn").click(function () {
        newflag = 2;
        var strlist = document.getElementById("newUserClass"); //获取Listbox 
        for (var j = 0; j < strlist.options.length; j++) {
            strlist.options[j].hidden = false;
        }

        $('#PhoneNo1Div').css("display", "none");
        $('#PhoneNoDiv').css("display", "block");
        $('#phoneWrn2Div').css("display", "none");
        $('#phoneWrn1').css("display", "none");
        $('#UIdWrn').css("display", "none");
        $('#userClassListDiv').css("display", "none");
        $('#newUserClass').removeAttr('disabled');
        $('#checknewUserClass').removeAttr('disabled');

        trSeq = $(this).parent().parent().parent().find("tr").index($(this).parent().parent());
        var txtUserId = $("#TableBody tr:eq(" + trSeq + ") td:eq(0)").text().trim();
        UId = txtUserId;
        document.getElementById("txtUserId").value = txtUserId;
        var userId = txtUserId;
        var txtUserName = $("#TableBody tr:eq(" + trSeq + ") td:eq(1)").text().trim();
        document.getElementById("txtUserName").value = txtUserName;
        var txtPassword = $("#TableBody tr:eq(" + trSeq + ") td:eq(2)").text().trim();
        document.getElementById("txtPassword").value = txtPassword;
        var userClassCode = $("#TableBody tr:eq(" + trSeq + ") td:eq(3)").text().trim();

        var userClass = $("#TableBody tr:eq(" + trSeq + ") td:eq(4)").text().trim();
        document.getElementById("userClassList").value = userClass;
        document.getElementById("userClassCode").value = userClassCode;
        var EndDate = $("#TableBody tr:eq(" + trSeq + ") td:eq(5)").text().trim();

        document.getElementById("EndDate").value = EndDate;
        $("#PhoneNo").val(GetPhoneNo(userId));
        OriPhoneNo = document.getElementById("PhoneNo").value;

        $('#New').css("display", "block");
        $('#CoachAndDoc').css("display", "none");
        $('#DocMod').css("display", "none");


        $('#setUserInfo').modal({
            closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
            containerId: 'reminder-container',
            overlayClose: true     //点击蒙层关闭窗口
        });
        var ret = "";

        $.ajax({
            url: "/Management/GetUserInfoById",
            type: "GET",
            dataType: "json",
            async: false,
            data: { UId: userId },
            success: function (res) {
                if (res != null) {
                    ret = res.toString();

                    var UserName = res.split("_")[0];
                    var Password = res.split("_")[1];
                    var EndDate = res.split("_")[2];
                    document.getElementById("txtUserName").value = UserName;
                    document.getElementById("txtPassword").value = Password;
                    document.getElementById("EndDate").value = EndDate;

                    var strlist = document.getElementById("newUserClass"); //获取Listbox 

                    var len = res.split("_").length - 3;
                    var Class = "";
                    for (i = 0; i < len; i++) {
                        Class = res.split("_")[3 + i];
                        if (strlist.options.length > 0) {
                            for (var j = 0; j < strlist.options.length; j++) {
                                if (strlist.options[j].value == Class) {
                                    strlist.options[j].hidden = true;
                                }
                            }
                        }
                    }




                }
                else {
                    ret = "";
                }
            }
        });
    });

    

    function trim(str) {  //删除左右两端的空格
        return str.replace(/(^\s*)|(\s*$)/g, "");
    }
    function refresh(e) {
        if (e.toString() == "OK") {
            alert("保存成功！");
        }
        else {
            alert("保存失败！");
        }
        window.location.href = window.location.href;
    }
    $("#NewRole").on('click', function () {
        $('#PhoneNo1Div').css("display", "block");
        $('#PhoneNoDiv').css("display", "none");
        $('#phoneWrn2Div').css("display", "none");
        $('#phoneWrn1').css("display", "none");
        $('#UIdWrn').css("display", "none");
        $('#userClassListDiv').css("display", "none");
        $('#newUserClass').attr('disabled', "disabled");
        $('#checknewUserClass').attr('disabled', "disabled");
        
        newflag = 1;
        var defaultEndTime;
        $.ajax({                                                //初始化日期控件为系统当前时间+1年（默认密码有效期为一年）
            url: "/Management/GetDefaultEndTime",
            type: "GET",
            dataType: "json",
            async: false,
            data: {},
            success: function (res) {
                defaultEndTime = res.toString();
            }
        });

        $('#New').css("display", "block");
        $('#CoachAndDoc').css("display", "none");
        $('#DocMod').css("display", "none");
        document.getElementById("txtUserId").value = "";
        document.getElementById("txtUserName").value = "";
        document.getElementById("txtPassword").value = "";
        $("#userClassList").val("");
        $("#userClassCode").val("");
      
        document.getElementById("EndDate").value = defaultEndTime;
        document.getElementById("PhoneNo").value = "";

        $('#setUserInfo').modal({
            closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
            containerId: 'reminder-container',
            overlayClose: true     //点击蒙层关闭窗口
        });


        var strlist = document.getElementById("newUserClass"); //获取Listbox 
        for (var j = 0; j < strlist.options.length; j++) {
            strlist.options[j].hidden = false;
        }
    });

    
    $('#checkPhoneNo1').on('click', function () {

        $('#phoneWrn1').css("display", "none");
        var PhoneNo1 = document.getElementById("PhoneNo1").value;
        if (PhoneNo1 == undefined) { PhoneNo1 = ""; }
        if (PhoneNo1.match(/^\d{11}$/) == null) {
            //alert("请输入11位手机号");
            event.preventDefault();
            var Text = "请输入11位手机号！";

            $('#phoneWrn1').html(Text);
            $('#phoneWrn1').css("display", "block");

        }
        else {
            //document.getElementById("PhoneNo1").disabled =
            $("#PhoneNo1").attr("disabled", "disabled");
            $("#checkPhoneNo1").attr("disabled", "disabled");
            $('#newUserClass').removeAttr('disabled');
            //$('#checknewUserClass').removeAttr('disabled');
            //此处判断该手机号有无用户Id
            $.ajax({
                url: "/Management/GetUIdByPhoneNo",
                type: "GET",
                dataType: "json",
                async: false,
                data: { PhoneNo: PhoneNo1 },
                success: function (res) {
                    if (res != null) {
                        UId = res.toString();
                    }
                    else {
                        UId = "";
                    }
                }
            });
            if (UId != "") {
                document.getElementById("txtUserId").value = UId;
                var Text = "该手机号已注册,请选择其他类型！";

                $('#phoneWrn1').html(Text);
                $('#phoneWrn1').css("display", "block");


                $('#phoneWrn2Div').css("display", "none");

                var ret = "";

                $.ajax({
                    url: "/Management/GetUserInfoById",
                    type: "GET",
                    dataType: "json",
                    async: false,
                    data: { UId: UId },
                    success: function (res) {
                        if (res != null) {
                            ret = res.toString();

                            var UserName = res.split("_")[0];
                            var Password = res.split("_")[1];
                            var EndDate = res.split("_")[2];
                            document.getElementById("txtUserName").value = UserName;
                            document.getElementById("txtPassword").value = Password;
                            document.getElementById("EndDate").value = EndDate;

                            var strlist = document.getElementById("newUserClass"); //获取Listbox 
                            
                            var len = res.split("_").length - 3;
                            var Class = "";
                            for (i = 0; i < len; i++) {
                                Class = res.split("_")[3 + i];
                                if (strlist.options.length > 0) {
                                    for (var j = 0; j < strlist.options.length; j++) {
                                        if (strlist.options[j].value == Class) {
                                            strlist.options[j].hidden = true;
                                        }
                                    }
                                }
                            }




                        }
                        else {
                            ret = "";
                        }
                    }
                });
                //$('#newUserClass').attr('disabled', "disabled");



            }
            else {

            }
        }
    });

    function UserClassChanged() {
        var clslist = document.getElementById("newUserClass");
        var userClass = clslist.options[clslist.selectedIndex].text;
        var userClassCode = clslist.options[clslist.selectedIndex].value;

        if (userClassCode != '0') {

            $('#checknewUserClass').removeAttr('disabled');
        }
        else {
            $('#checknewUserClass').attr('disabled', 'disabled');
        }
    }

    $('#checkPhoneNo2').on('click', function () {
        $('#phoneWrn1').css("display", "none");
        $('#phoneWrn2Div').css("display", "none");

        $("#newUserClass").val("Administrator");
        var userClassCode = "Administrator";
        $.ajax({
            url: "/Management/GetRoleNo",
            type: "GET",
            dataType: "json",
            async: false,
            data: { userClass: userClassCode },
            success: function (res) {
                var userId = res;
                if (userId != "") {
                    document.getElementById("txtUserId").value = userId;
                    document.getElementById("txtUserName").value = "";
                    document.getElementById("txtPassword").value = "";
                    $("#userClassList").val(userClass);
                    $("#userClassCode").val(userClassCode);
                    document.getElementById("EndDate").value = defaultEndTime;
                    document.getElementById("PhoneNo").value = "";


                    $('#CoachAndDoc').css("display", "none");
                    $('#DocMod').css("display", "none");
                }

            }
        });
    });


    $('#checknewUserClass').on('click', function () {
        //$("#newUserClass").val("0"); 
        $('#phoneWrn1').css("display", "none");
        $("#newUserClass").attr("disabled", "disabled");
        $("#checknewUserClass").attr("disabled", "disabled");

        var PhoneNo1 = document.getElementById("PhoneNo1").value;


        var clslist = document.getElementById("newUserClass");
        var userClass = clslist.options[clslist.selectedIndex].text;
        var userClassCode = clslist.options[clslist.selectedIndex].value;



        if (UId == "") {
            $.ajax({
                url: "/Management/GetRoleNo",
                type: "GET",
                dataType: "json",
                async: false,
                data: { userClass: userClassCode },
                success: function (res) {
                    var userId = res;
                    if (userId != "") {
                        document.getElementById("txtUserId").value = userId;
                        document.getElementById("txtUserName").value = "";
                        document.getElementById("txtPassword").value = "";
                        $("#userClassList").val(userClass);
                        $("#userClassCode").val(userClassCode);
                    
                        document.getElementById("PhoneNo").value = "";

                        if (userClassCode == 'HealthCoach') {
                            $('#CoachAndDoc').css("display", "block");
                            $('#DocMod').css("display", "none");
                            GetDoctorDetailInfo(userId, userClassCode);


                        }
                        else if (userClassCode == 'Doctor') {
                            $('#CoachAndDoc').css("display", "block");
                            $('#DocMod').css("display", "block");
                            //$("#Modules").chosen();
                            //$("#Modules").trigger("chosen:updated");
                            GetDoctorDetailInfo(userId, userClassCode);


                            $("#Modules").trigger("liszt:updated");
                            $("#Modules").chosen();

                        }
                        else {
                            $('#CoachAndDoc').css("display", "none");
                            $('#DocMod').css("display", "none");

                        }
                    }

                }
            });
        }
        else {
        //获取用户基本信息
            //document.getElementById("txtUserId").value = UId;

            $("#userClassList").val(userClass);
            $("#userClassCode").val(userClassCode);

            //document.getElementById("PhoneNo").value = "";
            if (userClassCode == 'Administrator') {
                var userClassCode = "Administrator";
                $.ajax({
                    url: "/Management/GetRoleNo",
                    type: "GET",
                    dataType: "json",
                    async: false,
                    data: { userClass: userClassCode },
                    success: function (res) {
                        var userId = res;
                        if (userId != "") {
                            document.getElementById("txtUserId").value = userId;
                            $("#userClassList").val(userClass);
                            $("#userClassCode").val(userClassCode);
                           


                            $('#CoachAndDoc').css("display", "none");
                            $('#DocMod').css("display", "none");
                        }

                    }
                });

            }
            else if (userClassCode == 'HealthCoach') {
                $('#CoachAndDoc').css("display", "block");
                $('#DocMod').css("display", "none");
                GetDoctorDetailInfo(UId, userClassCode);


            }
            else if (userClassCode == 'Doctor') {
                $('#CoachAndDoc').css("display", "block");
                $('#DocMod').css("display", "block");
                //                        $("#Modules").chosen();
                //                        $("#Modules").trigger("chosen:updated");
                GetDoctorDetailInfo(UId, userClassCode);


                $("#Modules").trigger("liszt:updated");
                $("#Modules").chosen();

            }
            else {
                $('#CoachAndDoc').css("display", "none");
                $('#DocMod').css("display", "none");

            }

        }
        $("#Dept").chosen({
            no_results_text: "没有找到相应的选项",
            placeholder_text: "请选择",
        });

    });



    $("#Cancel").on('click', function () {
        $('#phoneWrn').css("display", "none");
        $('#phoneWrn1').css("display", "none");
        $('#UIdWrn').css("display", "none");
        $('#phoneWrn2Div').css("display", "none");
        $("#PhoneNo1").removeAttr("disabled");
        $("#checkPhoneNo1").removeAttr("disabled");

        $('#CoachAndDoc').css("display", "none");
        $('#DocMod').css("display", "none");
        if (newflag == 2) {
            $("#newUserClass").removeAttr("disabled");
            $("#checknewUserClass").removeAttr("disabled");
        }
        else {
            $("#newUserClass").attr("disabled", "disabled");
            $("#checknewUserClass").attr("disabled", "disabled");
        }


        var defaultEndTime;
        $.ajax({                                                //初始化日期控件为系统当前时间+1年（默认密码有效期为一年）
            url: "/Management/GetDefaultEndTime",
            type: "GET",
            dataType: "json",
            async: false,
            data: {},
            success: function (res) {
                defaultEndTime = res.toString();
            }
        });

        document.getElementById("txtUserId").value = "";
        document.getElementById("txtUserName").value = "";
        document.getElementById("txtPassword").value = "";
        $("#newUserClass").val("0");
        $("#userClassList").val("");
        $("#userClassCode").val("");
        document.getElementById("EndDate").value = defaultEndTime;
        document.getElementById("PhoneNo").value = "";
        document.getElementById("PhoneNo1").value = "";

        document.getElementById("UnitName").value = "";
        document.getElementById("Dept").value = "";
        document.getElementById("JobTitle").value = "";

        $('#txtUserId').attr('disabled', "disabled");
        $('#txtUserId').removeAttr('disabled');
        //        window.location.href = window.location.href;
        var strlist = document.getElementById("newUserClass"); //获取Listbox 
        for (var j = 0; j < strlist.options.length; j++) {
            strlist.options[j].hidden = false;
        }
        $('*[title="Close"]').click();
    });

    $("#Save").bind('click', function (event) {

        $('#phoneWrn1').css("display", "none");
        $('#phoneWrn').css("display", "none");
        if (newflag == 1) {
            var PhoneNo1 = document.getElementById("PhoneNo1").value;
            if (PhoneNo1 == undefined) { PhoneNo1 = ""; }
            if (PhoneNo1.match(/^\d{11}$/) == null) {
                //alert("请输入11位手机号");
                event.preventDefault();
                var Text = "请输入11位手机号！";

                $('#phoneWrn1').html(Text);
                $('#phoneWrn1').css("display", "block");


            }
            else {
                var SetMstUserFlag = false;
                var userId = document.getElementById("txtUserId").value;

                if (userId == "") {

                    event.preventDefault();
                    var Text = "请选择一个用户！";
                    $('#UIdWrn').html(Text);
                    $('#UIdWrn').css("display", "block");

                }
                else {
                    var UserName = document.getElementById("txtUserName").value;
                    var Password = document.getElementById("txtPassword").value;
                    var userClass = document.getElementById("userClassList").value;
                    var userClassCode = document.getElementById("userClassCode").value;
                    var EndDate = document.getElementById("EndDate").value;
                    var PhoneNo = document.getElementById("PhoneNo1").value;
                    if (PhoneNo.match(/^\d{11}$/) == null) {
                        //alert("请输入11位手机号");
                        event.preventDefault();
                        var Text = "请输入11位手机号！";

                        $('#phoneWrn').html(Text);
                        $('#phoneWrn').css("display", "block");


                    }
                    else {

                        if (userId != "") {
                            $.ajax({
                                url: "/Management/setCmMstUser",
                                type: "GET",
                                dataType: "json",
                                async: false,
                                data: { UserId: userId, UserName: UserName, Password: Password, EndDate: EndDate, PhoneNo: PhoneNo, userClassCode: userClassCode, NewFlag: newflag },
                                success: function (res) {
                                    SetMstUserFlag = res;
                                    //                alert(res);
                                }
                            });
                        }
                        if (SetMstUserFlag == 1) {
                            if ((userClassCode == "Administrator") || (userClassCode == "Patient")) {
                                location.reload();
                            }
                            else {
                                var clslist = document.getElementById("UnitName");
                                var UnitName = clslist.options[clslist.selectedIndex].value;
                                var clslist = document.getElementById("Dept");
                                var Dept = clslist.options[clslist.selectedIndex].value;
                                var JobTitle = document.getElementById("JobTitle").value;

                                //alert(PhoneNo);

                                //获取多选框内容
                                var strlist = document.getElementById("Modules"); //获取Listbox 
                                var str = "";
                                //遍历Listbox，取得选中项的值 
                                if (strlist.options.length > 0) {
                                    for (var i = 0; i < strlist.options.length; i++) {
                                        if (strlist.options[i].selected == true) {
                                            var j = strlist.options[i].value;
                                            str += j + ","; //把Value值串起来
                                        }
                                    }
                                    var strValue = str.replace(/,$/, ""); //去掉最后一个逗号 

                                }
                                else {
                                    strValue = "";
                                    alert("No Item in Listbox");
                                }

                                setDocDetailInfo(userId, userClassCode, UnitName, Dept, JobTitle, strValue);

                                location.reload();
                            }

                        }
                    }
                }
            }
        }
        else if (newflag == 0) {
            var Flag = "";
            var PhoneNo = document.getElementById("PhoneNo").value;
            if (PhoneNo == undefined) { PhoneNo = ""; }
            $.ajax({
                url: "/Management/checkPhoneNoExist",
                type: "GET",
                dataType: "json",
                async: false,
                data: { PhoneNo: PhoneNo },
                success: function (res) {
                    Flag = res.toString();

                }
            });

            if (PhoneNo.match(/^\d{11}$/) == null) {
                //alert("请输入11位手机号");
                event.preventDefault();
                var Text = "请输入11位手机号！";

                $('#phoneWrn').html(Text);
                $('#phoneWrn').css("display", "block");


            }
            else if ((PhoneNo != OriPhoneNo) && (Flag == "0")) {

                //0代表手机号已存在
                var Text = "手机号已存在，请更换！";

                $('#phoneWrn').html(Text);
                $('#phoneWrn').css("display", "block");


            }
            else {
                var SetMstUserFlag = false;
                var userId = document.getElementById("txtUserId").value;

                if (userId == "") {

                    event.preventDefault();
                    var Text = "请选择一个用户！";
                    $('#UIdWrn').html(Text);
                    $('#UIdWrn').css("display", "block");

                }
                else {
                    var UserName = document.getElementById("txtUserName").value;
                    var Password = document.getElementById("txtPassword").value;
                    var userClass = document.getElementById("userClassList").value;
                    var userClassCode = document.getElementById("userClassCode").value;
                    var EndDate = document.getElementById("EndDate").value;
                    var PhoneNo = document.getElementById("PhoneNo").value;




                    $.ajax({
                        url: "/Management/setCmMstUser",
                        type: "GET",
                        dataType: "json",
                        async: false,
                        data: { UserId: userId, UserName: UserName, Password: Password, EndDate: EndDate, PhoneNo: PhoneNo, userClassCode: userClassCode, NewFlag: newflag },
                        success: function (res) {
                            SetMstUserFlag = res;
                            //                alert(res);
                        }
                    });

                    if (SetMstUserFlag == 1) {
                        if ((userClassCode == "Administrator") || (userClassCode == "Patient")) {
                            location.reload();
                        }
                        else {
                            var clslist = document.getElementById("UnitName");
                            var UnitName = clslist.options[clslist.selectedIndex].value;
                            var clslist = document.getElementById("Dept");
                            var Dept = clslist.options[clslist.selectedIndex].value;
                            var JobTitle = document.getElementById("JobTitle").value;

                            //alert(PhoneNo);

                            //获取多选框内容
                            var strlist = document.getElementById("Modules"); //获取Listbox 
                            var str = "";
                            //遍历Listbox，取得选中项的值 
                            if (strlist.options.length > 0) {
                                for (var i = 0; i < strlist.options.length; i++) {
                                    if (strlist.options[i].selected == true) {
                                        var j = strlist.options[i].value;
                                        str += j + ","; //把Value值串起来
                                    }
                                }
                                var strValue = str.replace(/,$/, ""); //去掉最后一个逗号 

                            }
                            else {
                                strValue = "";
                                alert("No Item in Listbox");
                            }

                            setDocDetailInfo(userId, userClassCode, UnitName, Dept, JobTitle, strValue);
                            location.reload();
                        }

                    }

                }
            }
        }
        else if (newflag == 2) {
            var Flag = "";
            var PhoneNo = document.getElementById("PhoneNo").value;
            if (PhoneNo == undefined) { PhoneNo = ""; }
            $.ajax({
                url: "/Management/checkPhoneNoExist",
                type: "GET",
                dataType: "json",
                async: false,
                data: { PhoneNo: PhoneNo },
                success: function (res) {
                    Flag = res.toString();

                }
            });

            if (PhoneNo.match(/^\d{11}$/) == null) {
                //alert("请输入11位手机号");
                event.preventDefault();
                var Text = "请输入11位手机号！";

                $('#phoneWrn').html(Text);
                $('#phoneWrn').css("display", "block");


            }
            else if ((PhoneNo != OriPhoneNo) && (Flag == "0")) {

                //0代表手机号已存在
                var Text = "手机号已存在，请更换！";

                $('#phoneWrn').html(Text);
                $('#phoneWrn').css("display", "block");


            }
            else {
                var SetMstUserFlag = false;
                var userId = document.getElementById("txtUserId").value;

                if (userId == "") {

                    event.preventDefault();
                    var Text = "请选择一个用户！";
                    $('#UIdWrn').html(Text);
                    $('#UIdWrn').css("display", "block");

                }
                else {
                    var UserName = document.getElementById("txtUserName").value;
                    var Password = document.getElementById("txtPassword").value;
                    var userClass = document.getElementById("userClassList").value;
                    var userClassCode = document.getElementById("userClassCode").value;
                    var EndDate = document.getElementById("EndDate").value;
                    var PhoneNo = document.getElementById("PhoneNo").value;




                    $.ajax({
                        url: "/Management/setCmMstUser",
                        type: "GET",
                        dataType: "json",
                        async: false,
                        data: { UserId: userId, UserName: UserName, Password: Password, EndDate: EndDate, PhoneNo: PhoneNo, userClassCode: userClassCode, NewFlag: newflag },
                        success: function (res) {
                            SetMstUserFlag = res;
                            //                alert(res);
                        }
                    });

                    if (SetMstUserFlag == 1) {
                        if ((userClassCode == "Administrator") || (userClassCode == "Patient")) {
                            location.reload();
                        }
                        else {
                            var clslist = document.getElementById("UnitName");
                            var UnitName = clslist.options[clslist.selectedIndex].value;
                            var clslist = document.getElementById("Dept");
                            var Dept = clslist.options[clslist.selectedIndex].value;
                            var JobTitle = document.getElementById("JobTitle").value;

                            //alert(PhoneNo);

                            //获取多选框内容
                            var strlist = document.getElementById("Modules"); //获取Listbox 
                            var str = "";
                            //遍历Listbox，取得选中项的值 
                            if (strlist.options.length > 0) {
                                for (var i = 0; i < strlist.options.length; i++) {
                                    if (strlist.options[i].selected == true) {
                                        var j = strlist.options[i].value;
                                        str += j + ","; //把Value值串起来
                                    }
                                }
                                var strValue = str.replace(/,$/, ""); //去掉最后一个逗号 

                            }
                            else {
                                strValue = "";
                                alert("No Item in Listbox");
                            }

                            setDocDetailInfo(userId, userClassCode, UnitName, Dept, JobTitle, strValue);
                            location.reload();
                        }

                    }

                }
            }
        }

    });

    function onSearch() {//js函数开始
        setTimeout(function () {//因为是即时查询，需要用setTimeout进行延迟，让值写入到input内，再读取  
            var UserList = document.getElementById('UserListDT'); //获取table的id标识  
            var searchRole = $("#SearchRole").val();
            var SearchPhoneNo = $("#SearchPhoneNo").val();
            var searchUserName = $("#SearchUserName").val();
            var searchText1;
            var searchText2;
            var searchText3;

            var rowsLength = UserList.rows.length; //表格总共有多少行  
            if (searchRole == "") {
                if (SearchPhoneNo == "") {
                    for (var i = 1; i < rowsLength; i++) {//按表的行数进行循环，本例第一行是标题，所以i=1，从第二行开始筛选（从0数起）   
                        searchText3 = UserList.rows[i].cells[1].innerHTML; //取得table行，列的值  
                        if (searchText3.match(searchUserName)) {//用match函数进行筛选，如果input的值，即变量 key的值为空，返回的是ture，  
                            UserList.rows[i].style.display = ''; //显示行操作，  
                        } else {
                            UserList.rows[i].style.display = 'none'; //隐藏行操作  
                        }
                    }
                }
                else if (searchUserName == "") {
                    for (var i = 1; i < rowsLength; i++) {
                        searchText2 = UserList.rows[i].cells[6].innerHTML; //取得table行，列的值
                        if (searchText2.match(SearchPhoneNo)) {
                            UserList.rows[i].style.display = ''; //显示行操作，  
                        } else {
                            UserList.rows[i].style.display = 'none'; //隐藏行操作  
                        }
                    }
                }
                else {
                    for (var i = 1; i < rowsLength; i++) {
                        searchText2 = UserList.rows[i].cells[6].innerHTML;
                        searchText3 = UserList.rows[i].cells[1].innerHTML;
                        if (searchText2.match(SearchPhoneNo) && searchText3.match(searchUserName)) {
                            UserList.rows[i].style.display = ''; //显示行操作，  
                        } else {
                            UserList.rows[i].style.display = 'none'; //隐藏行操作  
                        }
                    }
                }
            }
            else {
                if (SearchPhoneNo == "") {
                    for (var i = 1; i < rowsLength; i++) {
                        searchText1 = UserList.rows[i].cells[3].innerHTML;
                        searchText3 = UserList.rows[i].cells[1].innerHTML;
                        if (searchText1.match(searchRole) && searchText3.match(searchUserName)) {
                            UserList.rows[i].style.display = ''; //显示行操作，  
                        } else {
                            UserList.rows[i].style.display = 'none'; //隐藏行操作  
                        }
                    }
                }
                else if (searchUserName == "") {
                    for (var i = 1; i < rowsLength; i++) {
                        searchText1 = UserList.rows[i].cells[3].innerHTML;
                        searchText2 = UserList.rows[i].cells[6].innerHTML;
                        if (searchText1.match(searchRole) && searchText2.match(SearchPhoneNo)) {
                            UserList.rows[i].style.display = ''; //显示行操作，  
                        } else {
                            UserList.rows[i].style.display = 'none'; //隐藏行操作  
                        }
                    }
                }
                else {
                    for (var i = 1; i < rowsLength; i++) {
                        searchText1 = UserList.rows[i].cells[3].innerHTML;
                        searchText2 = UserList.rows[i].cells[6].innerHTML;
                        searchText3 = UserList.rows[i].cells[1].innerHTML;
                        if (searchText1.match(searchRole) && searchText2.match(SearchPhoneNo) && searchText3.match(searchUserName)) {
                            UserList.rows[i].style.display = ''; //显示行操作，  
                        } else {
                            UserList.rows[i].style.display = 'none'; //隐藏行操作  
                        }
                    }
                }
            }
        }, 200);              //200为延时时间  
    }

    function GetPhoneNo(userId) {

        var PhnoeNo = "";
        $.ajax({
            url: "/Management/GetPhoneNo",
            type: "GET",
            dataType: "json",
            async: false,
            data: { UserId: userId },
            success: function (res) {
                //alert(1);
                if (res == null) {
                    //                    PhnoeNo = "未填";
                    PhnoeNo = "";
                }
                else {
                    //alert(res);
                    PhnoeNo = res.toString();
                }
                //document.getElementById("PhnoeNo").value = res.toString();
            }
        });
        //alert(PhnoeNo);
        return PhnoeNo
    }



    function GetDoctorDetailInfo(userId, userClassCode) {
        $.ajax({
            url: "/Management/GetDoctorDetailInfo",
            type: "GET",
            dataType: "json",
            async: false,
            data: { UserId: userId, userClassCode: userClassCode },
            success: function (res) {
                var UnitName = res.split("_")[0];
                var Dept = res.split("_")[1];
                var JobTitle = res.split("_")[2];
                document.getElementById("UnitName").value = UnitName;
                document.getElementById("Dept").value = Dept;
                document.getElementById("JobTitle").value = JobTitle;
                if (userClassCode == "Doctor") {
                    $('.chzn-select').chosen({
                        placeholder_text_multiple: " "
                    });
                    $(".chosen-select").chosen();
                    var len = res.split("_").length - 3;
                    var m = [];
                    var Module = "";
                    for (i = 0; i < len; i++) {
                        Module = res.split("_")[3 + i];
                        m.push(Module);
                    }
                    $("#Modules").val(m);
                    $("#Modules").trigger("chosen:updated");
                    //$("#Modules").chosen({ width: "270px" }); 
                    //遍历Listbox，取得选中项的值 



                }
            }
        });
    }

    function setDocDetailInfo(userId, userClassCode, UnitName, Dept, JobTitle, Modules) {

        $.ajax({
            url: "/Management/setDocDetailInfo",
            type: "GET",
            dataType: "json",
            async: false,
            data: { UserId: userId, userClassCode: userClassCode, UnitName: UnitName, Dept: Dept, JobTitle: JobTitle, Modules: Modules },
            success: function (res) {
                if (res == true) {
                    //alert("setDocDetailInfo->success");

                }

            }
        });
    }

    //删除按钮触发
    $(".setDocBtn").click(function () {
        trSeq = $(this).parent().parent().parent().find("tr").index($(this).parent().parent());
        var txtUserId = $("#TableBody tr:eq(" + trSeq + ") td:eq(0)").text().trim();
        location.href = "/Management/ModuleManagement" + "?PatientId=" + txtUserId;
    });
</script>
